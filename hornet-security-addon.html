<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hornet Security Encryption Tags</title>
    
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    
    <style>
    .option {
        display: flex;
        align-items: flex-start;
        padding: 15px;
        margin: 10px 0;
        background: #f9f9f9;
        border-radius: 8px;
        transition: all 0.3s ease;
        cursor: pointer;
        min-height: 100px;
    }
    
    .option:hover {
        background: #e9f5ff;
        transform: translateX(3px);
        box-shadow: 0 2px 8px rgba(0,120,212,0.1);
    }
    
    .option input[type="checkbox"] {
        width: 20px;
        height: 20px;
        margin-right: 15px;
        margin-top: 3px;
        cursor: pointer;
    }
    
    .option-label {
        font-size: 15px;
        font-weight: 600;
        color: #0078d4;
        margin-bottom: 8px;
        display: block;
    }
    
    .option-description {
        font-size: 12px;
        color: #555;
        line-height: 1.5;
        margin-top: 5px;
    }
    
    .option-description strong {
        color: #333;
        font-weight: 600;
    }
    
    /* Make the panel wider to accommodate more text */
    .container {
        max-width: 400px;
    }
    
    /* Adjust for smaller screens */
    @media (max-width: 400px) {
        .option-description {
            font-size: 11px;
        }
    }
</style>
</head>
<body>
    <div class="container">
        <h1>
            <span>üîê</span>
            Hornet Security
        </h1>
        <div class="subtitle">Select encryption methods for this email</div>
        
        <div class="current-tags" id="currentTags">
            <strong>Current tags:</strong> <span id="currentTagsList"></span>
            <br>
            <button class="remove-tags-btn" onclick="removeTags()">Remove All Tags</button>
        </div>
        
        <div class="encryption-options">
    <!-- TLS Option -->
    <div class="option">
        <input type="checkbox" id="tls" name="encryption" value="TLS">
        <div style="flex: 1;">
            <label for="tls" class="option-label">TLS - Transport Layer Security</label>
            <div class="option-description">
                <strong>What it does:</strong> Encrypts email during transmission between mail servers<br>
                <strong>How it works:</strong> Creates secure tunnel for email transit, decrypted at destination<br>
                <strong>Use cases:</strong> Standard business emails, non-sensitive external communications, when recipient encryption status unknown
            </div>
        </div>
    </div>
    
    <!-- S/MIME Option -->
    <div class="option">
        <input type="checkbox" id="smime" name="encryption" value="S/MIME">
        <div style="flex: 1;">
            <label for="smime" class="option-label">S/MIME - Certificate-Based Encryption</label>
            <div class="option-description">
                <strong>What it does:</strong> End-to-end encryption using digital certificates<br>
                <strong>How it works:</strong> Uses public/private key pairs with trusted certificates<br>
                <strong>Use cases:</strong> Legal documents, contracts with partners, B2B communications where both parties have certificates
            </div>
        </div>
    </div>
    
    <!-- PGP Option -->
    <div class="option">
        <input type="checkbox" id="pgp" name="encryption" value="PGP">
        <div style="flex: 1;">
            <label for="pgp" class="option-label">PGP - Pretty Good Privacy</label>
            <div class="option-description">
                <strong>What it does:</strong> Strong end-to-end encryption using key pairs<br>
                <strong>How it works:</strong> Web of trust model with public/private keys<br>
                <strong>Use cases:</strong> Tech sector communications, international partners, journalists, when S/MIME unavailable
            </div>
        </div>
    </div>
    
    <!-- Websafe Option -->
    <div class="option">
        <input type="checkbox" id="websafe" name="encryption" value="Websafe">
        <div style="flex: 1;">
            <label for="websafe" class="option-label">Websafe - Secure Portal Delivery</label>
            <div class="option-description">
                <strong>What it does:</strong> Email never enters recipient inbox, accessed via secure portal<br>
                <strong>How it works:</strong> Recipient gets notification with link, authenticates to read message<br>
                <strong>Use cases:</strong> Sensitive data to personal emails (Gmail, Yahoo), confidential info to unknown recipients, financial/medical data
            </div>
        </div>
    </div>
    
    <!-- EmiG Option -->
    <div class="option">
        <input type="checkbox" id="emig" name="encryption" value="EmiG">
        <div style="flex: 1;">
            <label for="emig" class="option-label">EmiG - German Authority Standard</label>
            <div class="option-description">
                <strong>What it does:</strong> Compliance with German BSI security standards<br>
                <strong>How it works:</strong> Special encryption meeting government requirements with audit trails<br>
                <strong>Use cases:</strong> German authorities, healthcare providers, insurance companies, GDPR-critical data for German entities
            </div>
        </div>
    </div>
</div>
        
        <button class="apply-btn" onclick="applyEncryptionTags()">Apply Encryption Tags</button>
        
        <div class="status-message" id="statusMessage"></div>
    </div>
    
    <script>
        // Initialize Office.js
        Office.initialize = function(reason) {
            // Check current subject for existing tags when add-in loads
            checkExistingTags();
        };
        
        // Check for existing encryption tags in the subject
        function checkExistingTags() {
            try {
                const item = Office.context.mailbox.item;
                
                item.subject.getAsync(function(result) {
                    if (result.status === Office.AsyncResultStatus.Succeeded) {
                        const subject = result.value || "";
                        const tags = extractTags(subject);
                        
                        if (tags.length > 0) {
                            document.getElementById('currentTagsList').textContent = tags.join(', ');
                            document.getElementById('currentTags').classList.add('visible');
                            
                            // Pre-check the checkboxes for existing tags
                            tags.forEach(tag => {
                                const checkbox = document.querySelector(`input[value="${tag}"]`);
                                if (checkbox) {
                                    checkbox.checked = true;
                                }
                            });
                        }
                    }
                });
            } catch (error) {
                console.error("Error checking tags:", error);
            }
        }
        
        // Extract existing tags from subject
        function extractTags(subject) {
            const tagPattern = /\[(TLS|S\/MIME|PGP|Websafe|EmiG)\]/gi;
            const matches = subject.match(tagPattern);
            if (matches) {
                return matches.map(tag => tag.replace(/[\[\]]/g, ''));
            }
            return [];
        }
        
        // Remove all encryption tags from subject
        function removeTags() {
            try {
                const item = Office.context.mailbox.item;
                
                item.subject.getAsync(function(result) {
                    if (result.status === Office.AsyncResultStatus.Succeeded) {
                        let subject = result.value || "";
                        
                        // Remove all encryption tags
                        subject = subject.replace(/\[(TLS|S\/MIME|PGP|Websafe|EmiG)\]\s*/gi, '').trim();
                        
                        // Set the cleaned subject
                        item.subject.setAsync(subject, function(result) {
                            if (result.status === Office.AsyncResultStatus.Succeeded) {
                                showStatus("All encryption tags removed", "success");
                                document.getElementById('currentTags').classList.remove('visible');
                                
                                // Uncheck all checkboxes
                                document.querySelectorAll('input[name="encryption"]').forEach(cb => {
                                    cb.checked = false;
                                });
                            } else {
                                showStatus("Failed to remove tags: " + result.error.message, "error");
                            }
                        });
                    }
                });
            } catch (error) {
                showStatus("Error: " + error.message, "error");
            }
        }
        
        // Apply selected encryption tags to email subject
        function applyEncryptionTags() {
            try {
                // Get selected encryption methods
                const checkboxes = document.querySelectorAll('input[name="encryption"]:checked');
                
                if (checkboxes.length === 0) {
                    showStatus("Please select at least one encryption method", "info");
                    return;
                }
                
                // Build tags string
                const tags = Array.from(checkboxes).map(cb => `[${cb.value}]`).join('');
                
                // Get the current email item
                const item = Office.context.mailbox.item;
                
                // Get current subject
                item.subject.getAsync(function(result) {
                    if (result.status === Office.AsyncResultStatus.Succeeded) {
                        let currentSubject = result.value || "";
                        
                        // Remove any existing encryption tags first
                        currentSubject = currentSubject.replace(/\[(TLS|S\/MIME|PGP|Websafe|EmiG)\]\s*/gi, '').trim();
                        
                        // Add new tags at the beginning of the subject
                        const newSubject = tags + " " + currentSubject;
                        
                        // Set the new subject with encryption tags
                        item.subject.setAsync(newSubject.trim(), function(result) {
                            if (result.status === Office.AsyncResultStatus.Succeeded) {
                                showStatus("Encryption tags applied successfully!", "success");
                                
                                // Update current tags display
                                const selectedTags = Array.from(checkboxes).map(cb => cb.value);
                                document.getElementById('currentTagsList').textContent = selectedTags.join(', ');
                                document.getElementById('currentTags').classList.add('visible');
                            } else {
                                showStatus("Failed to apply tags: " + result.error.message, "error");
                            }
                        });
                    } else {
                        showStatus("Failed to get subject: " + result.error.message, "error");
                    }
                });
                
            } catch (error) {
                showStatus("Error: " + error.message, "error");
            }
        }
        
        // Show status message
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.textContent = message;
            statusDiv.className = 'status-message ' + type;
            
            // Hide after 3 seconds
            setTimeout(() => {
                statusDiv.className = 'status-message';
            }, 3000);
        }
        
        // Make option divs clickable
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.option').forEach(option => {
                option.addEventListener('click', function(e) {
                    if (e.target.type !== 'checkbox') {
                        const checkbox = this.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked;
                    }
                });
            });
        });
    </script>
</body>
</html>

